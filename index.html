<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Moroccan Youth Athletic Festival - Spring 2025 Registration</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <script src="https://www.paypal.com/sdk/js?client-id=ASNXc-c_Ozu9IRC4ILp5oC6VOLz18amVlbYfVnKYA2kvJIBlQnoLUPP-Rdz4J_vyMD5toHUwg-OQH-OX&currency=USD"></script>
  <style>
    .masar-logo {
      max-height: 120px;
      border-radius: 8px;
      padding: 4px;
      background-color: transparent;
    }
    .hero {
      background: linear-gradient(135deg, #00c4cc 0%, #0077cc 100%);
    }
    .form-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 2rem;
      box-shadow: 0 0.5em 1em -0.125em rgba(10,10,10,.1), 0 0 0 1px rgba(10,10,10,.02);
      border-radius: 8px;
      background: white;
    }
    .participant-box {
      border-left: 4px solid #00c4cc;
      padding-left: 1rem;
      margin-bottom: 1.5rem;
    }
    .section-title {
      border-bottom: 2px solid #00c4cc;
      padding-bottom: 0.5rem;
      margin-bottom: 1.5rem;
    }
  </style>
</head>

<body>
<section class="hero is-primary is-bold">
  <div class="hero-body">
    <div class="container">
      <div class="columns is-vcentered">
        <div class="column has-text-centered">
          <h1 class="title">Moroccan Youth Athletic Festival - Spring 2025</h1>
          <h2 class="subtitle is-4">Registration Form</h2>
        </div>
        <div class="column is-narrow">
          <figure class="image is-128x128">
            <img src="https://github.com/zlaflous/Moroccan-Youth-Athletic-Festival-Tournament-Registration/blob/main/MASAR_Logo_Transparent%20(1).png?raw=true" 
                 alt="MASAR Logo" 
                 class="masar-logo">
          </figure>
        </div>
      </div>
    </div>
  </div>
</section>

<div class="section">
  <div class="form-container">
    <form id="form" method="POST">
      <h2 class="title is-4 section-title">Parent Information</h2>
      <div class="field">
        <label class="label">Full Name</label>
        <div class="control">
          <input class="input" type="text" name="Parent Full Name" required>
        </div>
      </div>
      <div class="field">
        <label class="label">Email</label>
        <div class="control">
          <input class="input" type="email" name="Parent Email" required>
        </div>
      </div>
      <div class="field">
        <label class="label">Phone Number</label>
        <div class="control">
          <input class="input" type="tel" name="Parent Phone" required>
        </div>
      </div>

      <h2 class="title is-4 section-title">Participant Information</h2>
      <div id="participants-container"></div>
      <div class="field">
        <div class="control">
          <button class="button is-info" type="button" onclick="addParticipant()">
            <span class="icon">
              <i class="fas fa-plus"></i>
            </span>
            <span>Add Participant</span>
          </button>
        </div>
      </div>

      <h2 class="title is-4 section-title">Waiver & Consent</h2>
      <div class="field">
        <div class="control">
          <textarea class="textarea" readonly style="min-height: 150px;">
I, the parent or legal guardian of the participant, give permission for my child to take part in the Moroccan Youth Athletic Festival...
          </textarea>
        </div>
      </div>
      <div class="field">
        <div class="control">
          <label class="checkbox">
            <input type="checkbox" name="Waiver Consent" required> 
            I have read and agree to the above waiver.
          </label>
        </div>
      </div>

      <div id="total-due" class="notification is-info" style="display:none;">
        Total Due: $0
      </div>
      
      <div id="proceed-container" class="field mt-5">
        <div class="control">
          <button class="button is-warning is-medium" type="button" onclick="startPayPal()">
            Proceed to Payment
          </button>
        </div>
      </div>
      
      <div id="paypal-button-container" style="display:none;"></div>
    </form>
  </div>
</div>

<script src="https://kit.fontawesome.com/a076d05399.js"></script>
<script>
function addParticipant() {
  const container = document.getElementById('participants-container');
  const id = `participant-${Date.now()}`;
  const index = container.children.length;
  container.insertAdjacentHTML('beforeend', `
    <div class="box participant-box" id="${id}">
      <div class="is-flex is-justify-content-space-between is-align-items-center mb-3">
        <h3 class="title is-5">Participant ${index + 1}</h3>
        <button type="button" class="delete is-medium" onclick="removeParticipant('${id}')"></button>
      </div>
      <div class="field">
        <label class="label">First Name</label>
        <div class="control">
          <input class="input" type="text" name="Participant First Name[]" required>
        </div>
      </div>
      <div class="field">
        <label class="label">Last Name</label>
        <div class="control">
          <input class="input" type="text" name="Participant Last Name[]" required>
        </div>
      </div>
      <div class="field">
        <label class="label">Date of Birth</label>
        <div class="control">
          <input class="input" type="date" name="Participant DOB[]" required>
        </div>
      </div>
      <div class="field">
        <label class="label">Gender</label>
        <div class="control">
          <label class="radio">
            <input type="radio" name="Gender[]" value="boy" required onchange="toggleSoccerLevel('${id}', true)">
            Boy (Soccer)
          </label>
          <label class="radio">
            <input type="radio" name="Gender[]" value="girl" onchange="toggleSoccerLevel('${id}', false)">
            Girl (Race)
          </label>
        </div>
      </div>
      <div class="field soccer-level" id="soccer-${id}">
        <label class="label">Soccer Level</label>
        <div class="control">
          <div class="select is-fullwidth">
            <select name="Soccer Level[]">
              <option value="recreational">Recreational</option>
              <option value="travel">Travel</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  `);
  updateTotalAmount();
}

function toggleSoccerLevel(participantId, show) {
  const el = document.getElementById(`soccer-${participantId}`);
  if (el) el.style.display = show ? 'block' : 'none';
}

function sendFormData() {
  const form = document.getElementById('form');
  const formData = new FormData(form);
  
  // Collect all participant data including gender
  const formDataObj = {};
  formData.forEach((value, key) => {
    if (key.endsWith('[]')) {
      const cleanKey = key.replace('[]', '');
      if (!formDataObj[cleanKey]) formDataObj[cleanKey] = [];
      formDataObj[cleanKey].push(value);
    } else {
      formDataObj[key] = value;
    }
  });

  // Convert to URL-encoded string
  const keyValuePairs = [];
  for (const key in formDataObj) {
    if (Array.isArray(formDataObj[key])) {
      formDataObj[key].forEach(val => {
        keyValuePairs.push(`${encodeURIComponent(key)}=${encodeURIComponent(val)}`);
      });
    } else {
      keyValuePairs.push(`${encodeURIComponent(key)}=${encodeURIComponent(formDataObj[key])}`);
    }
  }

  fetch("https://script.google.com/macros/s/AKfycbxxtQnrbYjg06wBU30dmORSk3ef_bDZ-Qju5vaLJXx14vM80bNKFbsOo59GA_8do0Nw/exec", {
    method: "POST",
    body: keyValuePairs.join("&"),
    headers: {"Content-Type": "application/x-www-form-urlencoded"}
  }).then(response => {
    if (response.ok) window.location.href = "thank-you.html";
  });
}
</script>
</body>
</html>
