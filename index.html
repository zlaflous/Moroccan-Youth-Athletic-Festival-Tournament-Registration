<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moroccan Youth Athletic Festival - Spring 2025 Registration</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <script src="https://www.paypal.com/sdk/js?client-id=ASNXc-c_Ozu9IRC4ILp5oC6VOLz18amVlbYfVnKYA2kvJIBlQnoLUPP-Rdz4J_vyMD5toHUwg-OQH-OX&currency=USD"></script> <!-- Replace 'sb' with live Client ID -->
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 20px; }
        input, button { width: 100%; margin: 10px 0; padding: 10px; }
        #qr-code { margin-top: 20px; text-align: center; }
    </style>
</head>
<body>

<h2>Register for Moroccan Youth Athletic Festival - Spring 2025</h2>

<form id="registration-form">
    <input type="text" id="name" placeholder="Full Name" required>
    <input type="email" id="email" placeholder="Email Address" required>
    <input type="text" id="phone" placeholder="Phone Number" required>
    <input type="text" id="team" placeholder="Team Name (Optional)">
    <button type="submit">Proceed to Payment</button>
</form>

<div id="paypal-button-container" style="display:none;"></div>

<div id="qr-code"></div>

<script>
    emailjs.init("zlaflous@gmail.com"); // Replace with your EmailJS user ID

    let formData = {};

    document.getElementById('registration-form').addEventListener('submit', function(e) {
        e.preventDefault();
        formData = {
            name: document.getElementById('name').value,
            email: document.getElementById('email').value,
            phone: document.getElementById('phone').value,
            team: document.getElementById('team').value || 'N/A',
            ticketId: 'TICKET-' + Date.now()
        };

        document.getElementById('registration-form').style.display = 'none';
        document.getElementById('paypal-button-container').style.display = 'block';
    });

    paypal.Buttons({
        createOrder: function(data, actions) {
            return actions.order.create({
                purchase_units: [{
                    amount: { value: '10.00' },
                    payee: { email_address: 'ourmasar@gmail.com' },
                    description: 'Moroccan Youth Athletic Festival - Spring 2025 Registration'
                }]
            });
        },
        onApprove: function(data, actions) {
            return actions.order.capture().then(function(details) {
                generateQRCode();
                sendTicketByEmail();
            });
        }
    }).render('#paypal-button-container');

    function generateQRCode() {
        const qrData = `Name: ${formData.name}\nEmail: ${formData.email}\nPhone: ${formData.phone}\nTeam: ${formData.team}\nTicket ID: ${formData.ticketId}`;
        QRCode.toCanvas(document.createElement('canvas'), qrData, { width: 200 }, function (error, canvas) {
            if (error) console.error(error);
            document.getElementById('qr-code').appendChild(canvas);
        });
    }

    function sendTicketByEmail() {
        emailjs.send("service_1en0k3n", "service_1en0k3n", {
            name: formData.name,
            email: formData.email,
            phone: formData.phone,
            team: formData.team,
            ticket_id: formData.ticketId
        }).then(function(response) {
            alert('Registration complete! Check your email for your QR code ticket.');
        }, function(error) {
            console.error('FAILED...', error);
            alert('Registration complete, but failed to send email.');
        });
    }
</script>

</body>
</html>
